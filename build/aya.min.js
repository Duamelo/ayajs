var t;t=function(){"use strict";var h={svg:{fill:"white"},form:{stroke:"black",fill:"white",strokeOpacity:"1",strokeWidth:"1px",fillOpacity:"1",limitWidth:20,limitHeight:20},arc:{stroke:"black",fill:"white",strokeOpacity:"1",strokeWidth:"1px",fillOpacity:"1",limitWidth:20,limitHeight:20},box:{stroke:"black",strokeWidth:"1px",fill:"none",strokeDasharray:"4"},point:{fill:"black",strokeWidth:"1pt",radius:3},line:{fill:"black",ends:{start:{type:"circle"},dest:{type:"triangle"}}},text:{fill:"black",fillOpacity:"100",stroke:"black",strokeWidth:"0.5pt",strokeOpacity:100,strokeDasharray:10.5,strokeDashoffset:10.5}},i={};class u{static add(t){i[t.uuid]=t}static find(t){return i[t]}static clear(t){delete i[t]}static findAllLink(s){var e=[];return Object.keys(i).map(t=>{t=u.find(t);"link"!=t.type||s.uuid!=t.source.ref&&s.uuid!=t.destination.ref||e.push(t)}),e}static findAllComponents(){var s=[];return Object.keys(i).map(t=>{t=u.find(t);t instanceof C&&s.push(t)}),s}}class y{static generate(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}}const t=require("jsdom")["JSDOM"],s=new t("...");class l{constructor(t,s=0,e=0,i=5,h,n,r){this.ref=t,this.uuid=y.generate(),this.x=s,this.y=e,this.r=i,this.scale=1,this.events={},this.nativeEvent=n,this.config=r,this.type="point",this.c_svg="",this.svg=h,u.add(this)}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}setScale(t){this.scale=t}getScale(){return this.scale}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=s.window.document.createElementNS(t,"circle")||document.createElementNS(t,"circle"),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("cx",this.x),this.c_svg.setAttribute("cy",this.y),this.c_svg.setAttribute("r",this.config.point.radius*this.scale),this.c_svg.setAttribute("class","hidden_point"),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseover",t=>{this.r+=4,this.c_svg.setAttribute("r",this.r)}),this.addEvent("mouseleave",t=>{this.r=this.config.point.radius,this.c_svg.setAttribute("r",this.r)}),this.svg.appendChild(this.c_svg)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s}redraw(){this.c_svg.setAttribute("cx",this.x),this.c_svg.setAttribute("cy",this.y),this.c_svg.setAttribute("r",this.config.point.radius*this.scale)}}class e{addEvent(t,s){}deleteEvent(t){}addChild(t,s,e){}setOffsetX(t){}setOffsetY(t){}setScaleX(t){}setScaleY(t){}getOffsetX(){}getOffsetY(){}getScaleX(){}getScaleY(){}setRotateCenter(t,s){}setRotateAngle(t){}drawVertex(){}drawConnector(){}drawBox(){}draw(t){}removeFromDOM(){}redraw(){}shift(t,s){}resize(t,s,e){}optimalPath(t){}}const n=require("jsdom")["JSDOM"],r=new n("...");class o extends e{constructor(t,s=0,e=0,i=5,h,n,r){super(),this.uuid=t,this.x=s,this.y=e,this.r=i,this.events={},this.nativeEvent=n,this.config=r,this.box="",this.c_svg="",this.svg=h,this.type="circle",this.scale=1,this.offsetX=0,this.offsetY=0,this.angle=0,this.children=[],this.c_points=[new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config)],this.vertex=[new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,3,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s=null,e=null,i=!1){null!=s&&s(this,t),null!=e&&e(this,t),1==i&&t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX-this.r*this.scale,this.vertex[0].y=this.y+this.offsetY-this.r*this.scale,this.vertex[1].x=this.x+this.offsetX+this.r*this.scale,this.vertex[1].y=this.y+this.offsetY-this.r*this.scale,this.vertex[2].x=this.x+this.offsetX+this.r*this.scale,this.vertex[2].y=this.y+this.offsetY+this.r*this.scale,this.vertex[3].x=this.x+this.offsetX-this.r*this.scale,this.vertex[3].y=this.y+this.offsetY+this.r*this.scale)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX,this.c_points[0].y=this.y+this.offsetY-this.r*this.scale,this.c_points[1].x=this.x+this.offsetX+this.r*this.scale,this.c_points[1].y=this.y+this.offsetY,this.c_points[2].x=this.x+this.offsetX,this.c_points[2].y=this.y+this.offsetY+this.r*this.scale,this.c_points[3].x=this.x+this.offsetX-this.r*this.scale,this.c_points[3].y=this.y+this.offsetY)}drawBox(){var t;0<this.vertex.length&&0<this.c_points.length&&(t=`M ${this.vertex[0].x} ${this.vertex[0].y}
            L ${this.c_points[0].x} ${this.c_points[0].y} 
            L ${this.vertex[1].x}   ${this.vertex[1].y} 
            L ${this.c_points[1].x} ${this.c_points[1].y}
            L ${this.vertex[2].x}   ${this.vertex[2].y}
            L ${this.c_points[2].x} ${this.c_points[2].y} 
            L ${this.vertex[3].x}   ${this.vertex[3].y} 
            L ${this.c_points[3].x} ${this.c_points[3].y} Z`,this.box.setAttribute("d",t))}draw(){var t="http://www.w3.org/2000/svg";this.box=r.window.document.createElementNS(t,"path")||document.createElementNS(t,"path"),this.c_svg=r.window.document.createElementNS(t,"circle")||document.createElementNS(t,"circle"),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("cx",this.x+this.offsetX),this.c_svg.setAttribute("cy",this.y+this.offsetY),this.c_svg.setAttribute("r",this.r*this.scale),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttribute("stroke-width",this.config.form.strokeWidth),this.box.setAttributeNS(null,"stroke",this.config.box.stroke),this.box.setAttributeNS(null,"stroke-width",this.config.box.strokeWidth),this.box.setAttributeNS(null,"fill",this.config.box.fill),this.box.setAttribute("stroke-dasharray",this.config.box.strokeDasharray),this.svg.appendChild(this.c_svg),this.svg.appendChild(this.box),this.drawVertex(),this.drawConnector(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseover",this.nativeEvent.mouseOverCb),this.addEvent("mouseleave",this.nativeEvent.mouseLeaveCb)}removeBoxFromDOM(){this.svg.removeChild(this.box)}removeFromDOM(){this.svg.removeChild(this.box),this.svg.removeChild(this.c_svg),this.children.map(({child:t})=>{t.removeFromDOM()})}shift(t,s){this.x+=t,this.y+=s}redraw(){this.c_svg.setAttribute("cx",this.x+this.offsetX),this.c_svg.setAttribute("cy",this.y+this.offsetY),this.c_svg.setAttribute("r",this.r*this.scale),this.drawConnector(),this.drawVertex(),this.vertex.map(t=>{t.redraw()}),this.c_points.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?this.r+=-s:1==t||2==t?this.r+=s:this.r-=s,this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScale(t){this.scale=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScale(){return this.scale}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return n;return null}}const a=require("jsdom")["JSDOM"],d=new a("...");class c extends e{constructor(t,s=0,e=0,i=10,h=10,n,r,o){super(),this.uuid=t,this.x=s,this.y=e,this.width=i,this.height=h,this.events={},this.nativeEvent=r,this.config=o,this.c_svg="",this.svg=n,this.type="rectangle",this.children=[],this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.centerX=0,this.centerY=0,this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s=null,e=null,i=!0){null!=s&&s(this,t),null!=e&&e(this,t),1==i&&t.draw(),this.children.push({child:t,translate:s,rotate:e})}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=d.window.document.createElementNS(t,"rect")||document.createElementNS(t,"rect"),this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"id",this.uuid),this.c_svg.setAttributeNS(null,"height",this.height*this.scaleY),this.c_svg.setAttributeNS(null,"width",this.width*this.scaleX),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttributeNS(null,"fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.drawConnector(),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.children.map(({child:t})=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb),this.addEvent("mouseover",this.nativeEvent.mouseOverCb),this.addEvent("mouseleave",this.nativeEvent.mouseLeaveCb)}removeFromDOM(){this.svg.removeChild(this.c_svg),this.children.map(({child:t})=>{t.removeFromDOM()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}getWidth(){return this.width}getHeight(){return this.height}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=this.x+this.offsetX+this.width*this.scaleX,this.vertex[1].y=this.y+this.offsetY,this.vertex[2].x=this.x+this.offsetX+this.width*this.scaleX,this.vertex[2].y=this.y+this.offsetY+this.height*this.scaleY,this.vertex[3].x=this.x+this.offsetX,this.vertex[3].y=this.y+this.offsetY+this.height*this.scaleY)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[0].y=this.y+this.offsetY,this.c_points[1].x=this.x+this.offsetX+this.width*this.scaleX,this.c_points[1].y=this.y+this.offsetY+this.height/2*this.scaleY,this.c_points[2].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[2].y=this.y+this.offsetY+this.height*this.scaleY,this.c_points[3].x=this.x+this.offsetX,this.c_points[3].y=this.y+this.offsetY+this.height/2*this.scaleY)}shift(s,e){this.x+=s,this.y+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}redraw(){this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"height",this.height*this.scaleY),this.c_svg.setAttributeNS(null,"width",this.width*this.scaleX),this.drawVertex(),this.drawConnector(),this.c_points.map(t=>{t.redraw()}),this.vertex.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?(this.shift(s,e),this.width+=-s,this.height+=-e):1==t?(this.y+=e,this.width+=s,this.height+=-e):2==t?(this.width+=s,this.height+=e):3==t&&(this.x+=s,this.width+=-s,this.height+=e),this.width<this.config.form.limitWidth&&(this.width=this.config.form.limitWidth),this.height<this.config.form.limitHeight&&(this.height=this.config.form.limitHeight),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return n;return null}}class _{constructor(t,s,e=void 0){this.uuid=y.generate(),this.source=t,this.destination=s,this.line=e,this.type="link",u.add(this)}redraw(){var t,s,e=u.find(this.source.ref),i=u.find(this.destination.ref);null!=this.line&&(s=e.form.optimalPath(this.line),t=i.form.optimalPath(this.line),e=e.form.c_points[s],s=i.form.c_points[t],e&&(this.source=e),s&&(this.destination=s),this.line.x=this.source.x,this.line.y=this.source.y,this.line.dest_x=this.destination.x,this.line.dest_y=this.destination.y,console.log(this.line.c1.x+" "+this.line.c1.y),this.line.c_svg.setAttribute("fill","none"),this.line.redraw())}}const f=require("jsdom")["JSDOM"],m=new f("...").window["document"];class v{static setup=(s,e,i)=>{var h,n,r,o,a,d,l,c,f,v="",g="",x=[];return{mouseDownCb:function(t){r=t.offsetX,o=t.offsetY,h=t.srcElement.id,n=u.find(h),console.log(n),h!=this.id_svg&&(l=null!=n&&null!=n.ref?u.find(n.ref):n),null!=n&&(null!=n.form&&(c=u.findAllLink(n)),console.log("lk"),console.log(c),null!=n&&null==n.ref?v="moving":null!=l.form.vertex&&0<=(f=l.form.vertex.indexOf(n))?(v="resizing",r=t.offsetX,o=t.offsetY,"line"!=(n=u.find(n.ref)).type&&(c=u.findAllLink(n))):(v="drawing_link",console.log("state = drawing_link"),h=y.generate(),n!=l&&(g=new p(e,s,null,i,h,n.x,n.y)).draw()))},mouseMoveCb:function(t){var e;"moving"==v?(console.log("state = moving"),a=t.offsetX-r,d=t.offsetY-o,r=t.offsetX,o=t.offsetY,null!=n.form&&(c.map(s=>{n.form.c_points.map(t=>{t!=s.source&&t==s.destination&&(e=t)}),e?(console.log("dest"),console.log(e),s.line.dest_x+=a,s.line.dest_y+=d):(s.line.x+=a,s.line.y+=d),s.redraw()}),n.form.shift(a,d),n.form.redraw(),c.map(t=>{t.redraw()}))):"drawing_link"==v?(g.dest_x=t.clientX,g.dest_y=t.clientY,g.redraw()):"resizing"==v&&(a=t.offsetX-r,d=t.offsetY-o,r=t.offsetX,o=t.offsetY,l.form.resize(f,a,d),l.form.redraw(),c.map(t=>{t.redraw()}))},mouseUpCb:function(t){"drawing_link"==v&&(h=t.srcElement.id,null!=(t=u.find(h))&&null!=t.ref?(g.dest_x=t.x,g.dest_y=t.y,new _(n,t,g).redraw()):h!=e&&null!=t.ref||(t=m.getElementById(g.uuid),g.children.map(({child:t})=>{m.getElementById(t.uuid).remove()}),g.vertex.map(t=>{m.getElementById(t.uuid).remove()}),t.remove())),v=""},mouseOverCb:function(t){h=t.srcElement.id,x.push(h);t=u.find(h);null!=t&&("line"==t.form.type?(t.form.c_svg.setAttribute("class","move"),t.form.vertex.map(t=>{t.c_svg.setAttribute("class","default")})):null!=t.form&&(t.form.c_svg.setAttribute("class","move"),t.form.c_points.map(t=>{t.c_svg.setAttribute("class","show_point")}),t.form.vertex.map((t,s)=>{t.c_svg.setAttribute("class","show_point"),0==s?t.c_svg.setAttribute("class","resize_left_top"):1==s?t.c_svg.setAttribute("class","resize_right_top"):2==s?t.c_svg.setAttribute("class","resize_right_bottom"):3==s&&t.c_svg.setAttribute("class","resize_left_bottom")})))},mouseLeaveCb:function(t){u.findAllComponents().map(async t=>{setTimeout(()=>{t.form.c_points.map(t=>{t.c_svg.setAttribute("class","hidden_point")}),t.form.vertex.map(t=>{t.c_svg.setAttribute("class","hidden_point")})},5e3)})}}}}const g=require("jsdom")["JSDOM"],x=new g("...");class p extends e{constructor(t,s,e,i,h,n=0,r=0,o=n,a=r){var d;super(),this.uuid=h,this.x=n,this.y=r,this.dest_x=o,this.dest_y=a,this.c1={x:this.x,y:this.y},this.c2={x:this.x,y:this.y},this.c3={x:this.x,y:this.y},this.c4={x:this.x,y:this.y},this.events={},this.config=i,this.svg=s,this.id_svg=t,this.nativeEvent=e||v.setup(this.svg,this.id_svg,this.config),this.c_svg="",this.type="line",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.children=[],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],null!=this.config.line&&0<Object.keys(this.config.line.ends.start).length&&(d=O.createForm(y.generate(),this.config.line.ends.start.type,{},this.svg,this.nativeEvent,this.config),"triangle"==this.config.line.ends.start.type?this.addChild(d,(t,s)=>{s.x2=this.x,s.y2=this.y,s.x1=this.x-8,s.y1=this.y-3,s.x3=this.x-8,s.y3=this.y+3},(t,s)=>{s.setRotateCenter(s.x2,s.y2),s.setRotateAngle(t.calculateAngle()-Math.PI)}):"circle"==this.config.line.ends.start.type?this.addChild(d,(t,s)=>{s.setOffsetX(t.x-5),s.setOffsetY(t.y)},(t,s)=>{s.setRotateCenter(s.x,s.y),s.setRotateAngle(t.calculateAngle()+90*Math.PI/180)}):this.addChild(d,(t,s)=>{s.setOffsetX(t.x-this.config.line.ends.start.props.height/2),s.setOffsetY(t.y-this.config.line.ends.start.props.height/2)},(t,s)=>{s.setRotateCenter(s.x,s.y),s.setRotateAngle(t.calculateAngle()+90*Math.PI/180)})),null!=this.config.line&&0<Object.keys(this.config.line.ends.dest).length&&(d=O.createForm(y.generate(),this.config.line.ends.dest.type,{x1:this.dest_x-8,y1:this.dest_y-2,x2:this.dest_x,y2:this.dest_y,x3:this.dest_x-8,y3:this.dest_y+2},this.svg,this.nativeEvent,this.config),"triangle"==this.config.line.ends.dest.type?this.addChild(d,(t,s)=>{s.x2=this.dest_x,s.y2=this.dest_y,s.x1=this.dest_x-8,s.y1=this.dest_y-3,s.x3=this.dest_x-8,s.y3=this.dest_y+3},(t,s)=>{s.setRotateCenter(s.x2,s.y2),s.setRotateAngle(t.calculateAngle())}):this.addChild(d,(t,s)=>{s.setOffsetX(t.x-this.config.line.ends.dest.props.height/2),s.setOffsetY(t.y-this.config.line.ends.dest.props.height/2)},(t,s)=>{s.setRotateCenter(s.x,s.y),s.setRotateAngle(t.calculateAngle()+90*Math.PI/180)}))}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){t.vertex=[],t.c_points=[],s(this,t),e(this,t),t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=(this.dest_x+this.offsetX)*this.scaleX,this.vertex[1].y=(this.dest_y+this.offsetY)*this.scaleY)}drawConnector(){this.c_points.length}drawBox(){}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=x.window.document.createElementNS(t,"path")||document.createElementNS(t,"path"),this.p="M "+(this.x+this.offsetX)+","+(this.y+this.offsetY)+" "+(this.dest_x+this.offsetX)*this.scaleX+","+(this.dest_y+this.offsetY)*this.scaleY,this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",this.p),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.svg.appendChild(this.c_svg),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.children.map(({child:t})=>{"triangle"==t.type&&t.c_svg.setAttribute("fill","black"),t.c_svg.setAttribute("fill","black")}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseover",this.nativeEvent.mouseOverCb),this.addEvent("mouseleave",this.nativeEvent.mouseLeaveCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(t,s){this.x+=t,this.y+=s,this.dest_x+=t,this.dest_y+=s}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()});var t="M "+(this.x+this.offsetX)+","+(this.y+this.offsetY)+" "+(this.dest_x+this.offsetX)*this.scaleX+","+(this.dest_y+this.offsetY)*this.scaleY;this.c_svg.setAttribute("d",t),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}calculateAngle(){var t=0,s=(this.dest_y-this.y)/(this.dest_x-this.x);return this.dest_x==this.x&&(t=-Math.PI/2),0==s&&(t=0),0<=s&&this.x<this.dest_x&&this.y<this.dest_y?t=Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.y-this.dest_y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):0<=s&&this.x>this.dest_x&&this.y>this.dest_y?t=Math.PI+Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):s<=0&&this.x<this.dest_x&&this.y>this.dest_y?t=2*Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):s<=0&&this.x>this.dest_x&&this.y<this.dest_y&&(t=Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2)))),t}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}const F=require("jsdom")["JSDOM"],q=new F("...");class w extends e{constructor(t,s=0,e=0,i=5,h=5,n=10,r=10,o,a,d){super(),this.uuid=t,this.x1=s,this.y1=e,this.x2=i,this.y2=h,this.x3=n,this.y3=r,this.events={},this.nativeEvent=a,this.config=d,this.c_svg="",this.svg=o,this.type="triangle",this.children=[],this.offsetX=0,this.offsetY=0,this.scaleX=0,this.scaleY=0,this.angle=0,this.centerX=0,this.centerY=0,this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s,e){}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}drawVertex(){this.vertex.length}drawConnector(){this.c_points.length}drawBox(){}draw(){var t,s,e,i,h,n,r,o="http://www.w3.org/2000/svg";this.c_svg=q.window.document.createElementNS(o,"path")||document.createElementNS(o,"path"),0!=this.angle?(o=this.x1*Math.cos(this.angle)-this.y1*Math.sin(this.angle),t=this.x1*Math.sin(this.angle)+this.y1*Math.cos(this.angle),s=this.x2*Math.cos(this.angle)-this.y2*Math.sin(this.angle),e=this.x2*Math.sin(this.angle)+this.y2*Math.cos(this.angle),i=this.x3*Math.cos(this.angle)-this.y3*Math.sin(this.angle),h=this.x3*Math.sin(this.angle)+this.y3*Math.cos(this.angle),n=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),r=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),n=n-this.centerX,r=r-this.centerY,this.p="M "+(o-n+this.offsetX)+","+(t-r+this.offsetY)+" L "+(s-n+this.offsetX)+","+(e-r+this.offsetY)+" L "+(i-n+this.offsetX)+","+(h-r+this.offsetY)+" Z"):this.p="M "+(this.x1+this.offsetX)+","+(this.y1+this.offsetY)+" L "+(this.x2+this.offsetX)+","+(this.y2+this.offsetY)+" L "+(this.x3+this.offsetX)+","+(this.y3+this.offsetY)+" Z",this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",this.p),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb),this.addEvent("mouseover",this.nativeEvent.mouseOverCb),this.addEvent("mouseleave",this.nativeEvent.mouseLeaveCb)}removeFromDOM(){this.svg.removeChild(this.c_svg)}shift(s,e){this.x1+=s,this.y1+=e,this.x2+=s,this.y2+=e,this.x3+=s,this.y3+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}redraw(){var t,s,e,i,h,n,r,o;0!=this.angle?(t=this.x1*Math.cos(this.angle)-this.y1*Math.sin(this.angle),s=this.x1*Math.sin(this.angle)+this.y1*Math.cos(this.angle),e=this.x2*Math.cos(this.angle)-this.y2*Math.sin(this.angle),i=this.x2*Math.sin(this.angle)+this.y2*Math.cos(this.angle),h=this.x3*Math.cos(this.angle)-this.y3*Math.sin(this.angle),n=this.x3*Math.sin(this.angle)+this.y3*Math.cos(this.angle),r=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),o=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),r=r-this.centerX,o=o-this.centerY,this.p="M "+(t-r+this.offsetX)+","+(s-o+this.offsetY)+" L "+(e-r+this.offsetX)+","+(i-o+this.offsetY)+" L "+(h-r+this.offsetX)+","+(n-o+this.offsetY)+" Z"):this.p="M "+(this.x1+this.offsetX)+","+(this.y1+this.offsetY)+" L "+(this.x2+this.offsetX)+","+(this.y2+this.offsetY)+" L "+(this.x3+this.offsetX)+","+(this.y3+this.offsetY)+" Z",this.c_svg.setAttribute("d",this.p)}resize(t,s,e){0==t?(this.x1=s,this.y1=e,this.vertex[0].x=s,this.vertex[0].y=e):1==t?(this.x2=s,this.y2=e,this.vertex[1].x=s,this.vertex[1].y=e):2==t&&(this.x3=s,this.y3=e,this.vertex[2].x=s,this.vertex[2].y=e)}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return this.c_points[n];return null}}const R=require("jsdom")["JSDOM"],M=new R("...");class b extends e{constructor(t,s=0,e=0,i=10,h=30,n,r,o){super(),this.uuid=t,this.x=s,this.y=e,this.width=i,this.height=h,this.events={},this.nativeEvent=r,this.config=o,this.c_svg="",this.svg=n,this.box="",this.type="lozenge",this.p="",this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.angle=0,this.centerX=0,this.centerY=0,this.children=[],this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s=null,e=null,i=!0){t.setOffsetX(this.x),t.setOffsetY(this.y),null!=s&&s(this,t),null!=e&&e(this,t),i&&t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){0!=this.vertex.length&&(this.vertex[0].x=this.x+this.offsetX-this.width/2*this.scaleX,this.vertex[0].y=this.y+this.offsetY,this.vertex[1].x=this.x+this.offsetX+this.width/2*this.scaleX,this.vertex[1].y=this.y+this.offsetY,this.vertex[2].x=this.x+this.offsetX+this.width/2*this.scaleX,this.vertex[2].y=this.y+this.offsetY+this.height*this.scaleY,this.vertex[3].x=this.x+this.offsetX-this.width/2*this.scaleX,this.vertex[3].y=this.y+this.offsetY+this.height*this.scaleY)}drawConnector(){0!=this.c_points.length&&(this.c_points[0].x=this.x+this.offsetX,this.c_points[0].y=this.y+this.offsetY,this.c_points[1].x=this.x+this.offsetX+this.width/2*this.scaleX,this.c_points[1].y=this.y+this.offsetY+this.height/2*this.scaleY,this.c_points[2].x=this.x+this.offsetX,this.c_points[2].y=this.y+this.offsetY+this.height*this.scaleY,this.c_points[3].x=this.x+this.offsetX-this.width/2*this.scaleX,this.c_points[3].y=this.y+this.offsetY+this.height/2*this.scaleY)}draw(){var t,s,e,i="http://www.w3.org/2000/svg";this.c_svg=M.window.document.createElementNS(i,"path")||document.createElementNS(i,"path"),this.box=M.window.document.createElementNS(i,"path")||document.createElementNS(i,"path"),0!=this.angle?(i=this.x*Math.cos(this.angle)-this.y*Math.sin(this.angle),t=this.x*Math.sin(this.angle)+this.y*Math.cos(this.angle),s=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),e=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),s=s-this.centerX,e=e-this.centerY,this.p=`M ${i-s+this.offsetX} ${t-e+this.offsetY}  L ${i-s+this.offsetX+this.width/2*this.scaleX} ${t-e+this.offsetY+this.height/2*this.scaleY}  L ${i-s+this.offsetX} ${t-e+this.offsetY+this.height*this.scaleY}  L ${i-s+this.offsetX-this.width/2*this.scaleX} ${t-e+this.offsetY+this.height/2*this.scaleY}Z`):this.p=`M ${this.x+this.offsetX} ${this.y+this.offsetY}  L ${this.x+this.offsetX+this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}  L ${this.x+this.offsetX} ${this.y+this.offsetY+this.height*this.scaleY}  L ${this.x+this.offsetX-this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}Z`,this.drawVertex(),this.drawConnector(),this.c_svg.setAttribute("d",this.p),this.vertex.map(t=>{t.draw()}),this.c_points.map(t=>{t.draw()}),this.box.setAttribute("id",this.uuid),this.box.setAttributeNS(null,"stroke",this.config.box.stroke),this.box.setAttributeNS(null,"stroke-width",this.config.box.strokeWidth),this.box.setAttributeNS(null,"fill",this.config.box.fill),this.box.setAttribute("stroke-dasharray",this.config.box.strokeDasharray),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("d",this.p),this.c_svg.setAttributeNS(null,"stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("fill",this.config.form.fill),this.svg.appendChild(this.c_svg),this.svg.appendChild(this.box),this.addEvent("mousedown",this.nativeEvent.mouseDownCb),this.addEvent("mouseup",this.nativeEvent.mouseUpCb),this.addEvent("mouseover",this.nativeEvent.mouseOverCb),this.addEvent("mouseleave",this.nativeEvent.mouseLeaveCb)}removeFromDOM(){this.svg.removeChild(this.box),this.svg.removeChild(this.c_svg),this.children.map(({child:t})=>{t.removeFromDOM()})}redraw(){var t,s,e,i;0!=this.angle?(t=this.x*Math.cos(this.angle)-this.y*Math.sin(this.angle),s=this.x*Math.sin(this.angle)+this.y*Math.cos(this.angle),e=this.centerX*Math.cos(this.angle)-this.centerY*Math.sin(this.angle),i=this.centerX*Math.sin(this.angle)+this.centerY*Math.cos(this.angle),e=e-this.centerX,i=i-this.centerY,this.p=`M ${t-e+this.offsetX} ${s-i+this.offsetY}  L ${t-e+this.offsetX+this.width/2*this.scaleX} ${s-i+this.offsetY+this.height/2*this.scaleY}  L ${t-e+this.offsetX} ${s-i+this.offsetY+this.height*this.scaleY}  L ${t-e+this.offsetX-this.width/2*this.scaleX} ${s-i+this.offsetY+this.height/2*this.scaleY}Z`):this.p=`M ${this.x+this.offsetX} ${this.y+this.offsetY}  L ${this.x+this.offsetX+this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}  L ${this.x+this.offsetX} ${this.y+this.offsetY+this.height*this.scaleY}  L ${this.x+this.offsetX-this.width/2*this.scaleX} ${this.y+this.offsetY+this.height/2*this.scaleY}Z`,this.drawVertex(),this.drawConnector(),this.c_svg.setAttribute("d",this.p),this.vertex.map(t=>{t.redraw()}),this.c_points.map(t=>{t.redraw()}),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}resize(t,s,e){0==t?(this.shift(s,e),this.width+=-s,this.height+=-e):1==t?(this.y+=e,this.width+=s,this.height+=-e):2==t?(this.width+=s,this.height+=e):3==t&&(this.x+=s,this.width+=-s,this.height+=e),this.width<this.config.form.limitWidth&&(this.width=this.config.form.limitWidth),this.height<this.config.form.limitHeight&&(this.height=this.config.form.limitHeight),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}drawBox(){var t;0!=this.c_points.length&&0!=this.vertex.length&&(t=`M ${this.vertex[0].x} ${this.vertex[0].y}
              L ${this.c_points[0].x} ${this.c_points[0].y} 
              L ${this.vertex[1].x}   ${this.vertex[1].y} 
              L ${this.c_points[1].x} ${this.c_points[1].y}
              L ${this.vertex[2].x}   ${this.vertex[2].y}
              L ${this.c_points[2].x} ${this.c_points[2].y} 
              L ${this.vertex[3].x}   ${this.vertex[3].y} 
              L ${this.c_points[3].x} ${this.c_points[3].y} Z`,this.box.setAttribute("d",t))}shift(s,e){this.x+=s,this.y+=e,this.c_points.map(t=>{t.shift(s,e)}),this.vertex.map(t=>{t.shift(s,e)})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(t){for(var s,e,i=(t.dest_y-t.y)/(t.dest_x-t.x),h=t.y-i*t.x,n=0;n<=3;n++)if(n%2==0?s=((e=this.vertex[n].y)-h)/i:e=i*(s=this.vertex[n].x)+h,!(s==t.x&&e==t.y||s==t.dest_x&&e==t.dest_y)&&(0==n&&s>this.vertex[n].x&&s<this.vertex[n+1].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||1==n&&e>this.vertex[n].y&&e<this.vertex[n+1].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||2==n&&s>this.vertex[n+1].x&&s<this.vertex[n].x&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))||3==n&&e>=this.vertex[0].y&&e<=this.vertex[n].y&&((t.x<=t.dest_x&&s<=t.dest_x&&s>=t.x&&i<0?e>=t.dest_y&&e<=t.y:e<=t.dest_y&&e>=t.y)||(t.x>=t.dest_x&&s>=t.dest_x&&s<=t.x&&i<0?e<=t.dest_y&&e>=t.y:e>=t.dest_y&&e<=t.y))))return n;return null}}const I=require("jsdom")["JSDOM"],W=new I("...");class X extends e{constructor(t,s=[],e,i,h){super(),this.uuid=t,this.x=s[0],this.y=s[1],this.dest_x=s[s.length-2],this.dest_y=s[s.length-1],this.points=s,this.events={},this.nativeEvent=i,this.config=h,this.c_svg="",this.svg=e,this.type="polyline",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.angle=0,this.children=[],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s=null,e=null,i=!0){t.vertex=[],t.c_points=[],null!=s&&s(this,t),null!=e&&e(this,t),1==i&&t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){this.vertex.length}drawConnector(){this.c_points.length}drawBox(){}draw(){for(var t="http://www.w3.org/2000/svg",s=(this.c_svg=W.window.document.createElementNS(t,"polyline")||document.createElementNS(t,"polyline"),""),e=0;e<this.points.length;e++)s+=e%2==0?this.points[e]+",":this.points[e]+" ";this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.form.strokeWidth),this.c_svg.setAttribute("points",s),this.svg.appendChild(this.c_svg),this.drawVertex(),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}removeFromDOM(){this.svg.removeChild(this.c_svg),this.children.map(({child:t})=>{t.removeFromDOM()})}shift(t,s){}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()});var t=this.points.map((t,s)=>{})+" ";this.c_svg.setAttribute("point",t),this.children.map(({child:t,translate:s,rotate:e})=>{null!=s&&s(this,t),null!=e&&e(this,t),t.redraw()})}calculateAngle(){var t,s=(this.dest_y-this.y)/(this.dest_x-this.x);return 0==s&&(t=0),0<=s&&this.x<this.dest_x&&this.y<this.dest_y?t=Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.y-this.dest_y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):0<=s&&this.x>this.dest_x&&this.y>this.dest_y?t=Math.PI+Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):s<=0&&this.x<this.dest_x&&this.y>this.dest_y?t=2*Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2))):s<=0&&this.x>this.dest_x&&this.y<this.dest_y&&(t=Math.PI-Math.asin(Math.sqrt(Math.pow(this.x-this.x,2)+Math.pow(this.dest_y-this.y,2))/Math.sqrt(Math.pow(this.x-this.dest_x,2)+Math.pow(this.y-this.dest_y,2)))),t}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}const j=require("jsdom")["JSDOM"],z=new j("...");class Y extends e{constructor(t,s=0,e=0,i=100,h=100,n=90,r=.5,o,a,d){super(),this.uuid=t,this.x0=s,this.y0=e,this.x=i,this.y=h,this.angle=n,this.offsetX0=0,this.offsetY0=0,this.offsetX=0,this.offsetY=0,this.dest_x=Math.round(this.x0+this.offsetX0+(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.cos(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.sin(this.angle*Math.PI/180)),this.dest_y=Math.round(this.y0+this.offsetY0-(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.sin(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.cos(this.angle*Math.PI/180)),this.events={},this.nativeEvent=a,this.config=d,this.c_svg="",this.svg=o,this.type="arc",this.scaleX=1,this.scaleY=1,this.radius=Math.sqrt((this.x+this.offsetX-(this.x0+this.offsetX0))*(this.x+this.offsetX-(this.x0+this.offsetX0))+(this.y+this.offsetY-(this.y0+this.offsetY0))*(this.y+this.offsetY-(this.y0+this.offsetY0))),this.ratio=r,this.children=[],this.vertex=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)],this.c_points=[new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config),new l(this.uuid,0,0,5,this.svg,this.nativeEvent,this.config)]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addChild(t,s=null,e=null,i=!0){t.vertex=[],t.c_points=[],t.setOffsetX(this.x),t.setOffsetY(this.y),null!=s&&s(this,t),null!=e&&e(this,t),1==i&&t.draw(),this.children.push({child:t,translate:s,rotate:e})}drawVertex(){this.vertex.length}drawConnector(){this.c_points.length}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=z.window.document.createElementNS(t,"path")||document.createElementNS(t,"path"),this.dest_x=Math.round(this.x0+this.offsetX0+(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.cos(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.sin(this.angle*Math.PI/180)),this.dest_y=Math.round(this.y0+this.offsetY0-(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.sin(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.cos(this.angle*Math.PI/180)),this.p="M"+(this.x0==this.x?this.x0:this.x0+this.ratio*(this.x-this.x0))+" "+(this.x0==this.x?this.y0+this.ratio*(this.y-this.y0):(this.y-this.y0)/(this.x-this.x0)*(this.x0+this.ratio*(this.x-this.x0))+(this.y0-(this.y-this.y0)/(this.x-this.x0)*this.x0))+"  L"+this.x+" "+this.y+" A "+this.radius+" "+this.radius+" 0 "+(180<this.angle?1:0)+" 0 "+this.dest_x+" "+this.dest_y+" L "+(this.dest_x-(1-this.ratio)*(this.dest_x-this.x0))+" "+((this.dest_y-this.y0)/(this.dest_x-this.x0)*(this.dest_x-(1-this.ratio)*(this.dest_x-this.x0))+(this.y0-(this.dest_y-this.y0)/(this.dest_x-this.x0)*this.x0)),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.arc.fill),this.c_svg.setAttribute("stroke",this.config.arc.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.arc.strokeWidth),this.c_svg.setAttribute("d",this.p),this.svg.appendChild(this.c_svg),this.c_points.map(t=>{t.draw()}),this.vertex.map(t=>{t.draw()}),this.addEvent("mouseover",()=>{this.c_svg.setAttribute("class","move")})}removeFromDOM(){this.svg.removeChild(this.c_svg),this.children.map(({child:t})=>{t.removeFromDOM()})}shift(t,s){this.x0+=t,this.y0+=s,this.x+=t,this.y+=s}redraw(){this.drawVertex(),this.vertex.map(t=>{t.redraw()}),this.dest_x=Math.round(this.x0+this.offsetX0+(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.cos(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.sin(this.angle*Math.PI/180)),this.dest_y=Math.round(this.y0+this.offsetY0-(this.x+this.offsetX-(this.x0+this.offsetX0))*Math.sin(this.angle*Math.PI/180)+(this.y+this.offsetY-(this.y0+this.offsetY0))*Math.cos(this.angle*Math.PI/180)),this.p="M "+this.x+" "+this.y+" A "+this.radius+" "+this.radius+" 0 "+(180<this.angle?1:0)+" 0 "+this.dest_x+" "+this.dest_y,this.c_svg.setAttribute("d",this.p),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),e(this,t),t.redraw()})}calculateAngle(t,s,e,i){var h,n=(i-s)/(e-t);return e==t&&(h=-Math.PI/2),0==n&&(h=0),0<=n&&t<e&&s<i?h=Math.asin(Math.sqrt(Math.pow(t-t,2)+Math.pow(s-i,2))/Math.sqrt(Math.pow(t-e,2)+Math.pow(s-i,2))):0<=n&&e<t&&i<s?h=Math.PI+Math.asin(Math.sqrt(Math.pow(t-t,2)+Math.pow(i-s,2))/Math.sqrt(Math.pow(t-e,2)+Math.pow(s-i,2))):n<=0&&t<e&&i<s?h=2*Math.PI-Math.asin(Math.sqrt(Math.pow(t-t,2)+Math.pow(i-s,2))/Math.sqrt(Math.pow(t-e,2)+Math.pow(s-i,2))):n<=0&&e<t&&s<i&&(h=Math.PI-Math.asin(Math.sqrt(Math.pow(t-t,2)+Math.pow(i-s,2))/Math.sqrt(Math.pow(t-e,2)+Math.pow(s-i,2)))),h}resize(t,s,e){0==t?(this.x+=s,this.y+=e):(this.dest_x+=s,this.dest_y+=e),this.children.map(({child:t,translate:s,rotate:e})=>{s(this,t),t.setRotateAngle(this.calculateAngle()+90*Math.PI/180),e(this,t),t.redraw()})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setOffsetX0(t){this.offsetX0=t}setOffsetY0(t){this.offsetY0=t}setScaleX(t){this.scaleX=t}setScaleY(t){this.scaleY=t}getRotateAngle(){return this.angle}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getOffsetX0(){return this.offsetX0}getOffsetY0(){return this.offsetY0}getScaleX(){return this.scaleX}getScaleY(){return this.scaleY}optimalPath(){}}const V=require("jsdom")["JSDOM"],T=new V("...");class E{constructor(t,s,e,i){this.uuid=t,this.events={},this.nativeEvent=e,this.config=i,this.c_svg="",this.svg=s,this.type="group",this.angle=0,this.centerX=0,this.centerY=0,this.c_svg="",this.children=[]}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}addShape(t=[]){t.map(t=>{this.children.push(t)})}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}setOffsetX(t){this.offsetX=t}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=T.window.document.createElementNS(t,"g")||document.createElementNS(t,"g"),this.c_svg.setAttribute("id",this.uuid),this.c_svg.setAttribute("fill",this.config.form.fill),this.c_svg.setAttribute("stroke",this.config.form.stroke),this.children.map(t=>{this.c_svg.appendChild(t.c_svg)}),this.c_svg.setAttribute("transform","rotate("+this.angle+","+this.centerX+","+this.centerY+")"),this.svg.appendChild(this.c_svg),this.addEvent("mousedown",this.nativeEvent.mouseDownCb)}redraw(){this.c_svg.setAttribute("transform","rotate("+this.angle+","+this.centerX+","+this.centerY+")")}removeFromDOM(){this.children.map(t=>{console.log(t),t.removeFromDOM()}),this.svg.removeChild(this.c_svg)}}const B=require("jsdom")["JSDOM"],J=new B("...");class A{constructor(t,s=0,e=0,i="text",h,n,r){this.uuid=t,this.x=s,this.y=e,this.text=i,this.svg=h,this.c_svg="",this.events={},this.nativeEvent=n,this.config=r,this.offsetX=0,this.offsetY=0,this.centerX=0,this.centerY=0,this.parentWidth=0,this.parentHeight=0,this.parentX=0,this.parentY=0,this.angle=0,this.tspan="",this.title=""}addEvent(t,s){this.c_svg.addEventListener(t,s),this.events[t]=s}deleteEvent(t){var s=this.events[t];this.c_svg.removeEventListener(t,s),delete this.events[t]}setRotateCenter(t,s){this.centerX=t,this.centerY=s}setRotateAngle(t){this.angle=t}draw(){var t="http://www.w3.org/2000/svg";this.c_svg=J.window.document.createElementNS(t,"text")||document.createElementNS(t,"text"),this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttributeNS(null,"id",this.uuid),this.c_svg.setAttributeNS(null,"fill",this.config.text.fill),this.c_svg.setAttributeNS(null,"stroke",this.config.text.stroke),this.c_svg.setAttributeNS(null,"stroke-width",this.config.text.strokeWidth),this.c_svg.setAttributeNS(null,"fill-opacity",this.config.text.fillOpacity),this.c_svg.setAttributeNS(null,"stroke-dasharray",this.config.text.strokeDasharray),this.c_svg.setAttributeNS(null,"stroke-dashoffset",this.config.text.strokeDashoffset),this.c_svg.setAttribute("transform","rotate("+this.angle+","+this.centerX+","+this.centerY+")"),this.title=document.createElementNS(t,"title"),this.title.textContent=this.text,this.c_svg.textContent=this.text,this.c_svg.appendChild(this.title),this.svg.appendChild(this.c_svg)}updateWidthText(t=5){var s="",e=!1,i=this.parentWidth+this.parentX-this.offsetX,i=i<6*this.text.length?i/6:0;0==i?s=this.text.substring(t=0,this.text.length):(s=this.text.substring(0,i-t),e=!0),e&&(s=s.concat("...")),this.tspan.textContent=s,this.title.textContent=this.text}shift(t,s){this.x+=t,this.y+=s}removeFromDOM(){this.c_svg.textContent=""}redraw(){this.c_svg.setAttributeNS(null,"x",this.x+this.offsetX),this.c_svg.setAttributeNS(null,"y",this.y+this.offsetY),this.c_svg.setAttribute("transform","rotate("+this.angle+","+this.centerX+","+this.centerY+")")}setOffsetX(t){this.offsetX=t}setOffsetY(t){this.offsetY=t}setText(t){this.text=t}getOffsetX(){return this.offsetX}getOffsetY(){return this.offsetY}getParentWidth(){return this.parentWidth}setParentWidth(t){this.parentWidth=t}getParentHeight(){return this.parentHeight}setParentHeight(t){this.parentHeight=t}setParentX(t){this.parentX=t}setParentY(t){this.parentY=t}}class O{static createForm(t,s,e={},i,h,n){return"circle"==s?new o(t,e.x,e.y,e.r,i,h,n):"rectangle"==s?new c(t,e.x,e.y,e.width,e.height,i,h,n):"line"==s?new p(0,i,h,n,t,e.x,e.y,e.dest_x,e.dest_y):"triangle"==s?new w(t,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3,i,h,n):"lozenge"==s?new b(t,e.x,e.y,e.width,e.height,i,h,n):"polyline"==s?new X(t,e.points,i,h,n):"arc"==s?new Y(t,e.x0,e.y0,e.x,e.y,e.angle,e.ratio,i,h,n):"group"==s?new E(t,i,h,n):"text"==s?new A(t,e.x,e.y,e.text,i,h,n):void 0}}class C{constructor(t,s,e,i,h){this.uuid=y.generate(),this.type=t,this.form=O.createForm(this.uuid,t,s,e,i,h),u.add(this),this.form.draw()}}class S{constructor(t,s,e,i,h="",n){this.design_pattern=[aya.Text(0,0,"adapter"),aya.Text(0,0,"composite"),aya.Text(0,0,"chain of responsability"),aya.Text(0,0,"decorator"),aya.Text(0,0,"strategy")],this.x_circle=t,this.y_circle=s,this.r_circle=e,this.points=[Math.cos((60-30*i)*Math.PI/180)*this.r_circle+this.x_circle,Math.sin((60-30*i)*Math.PI/180)*this.r_circle+this.y_circle,this.x_circle+this.r_circle+5,this.y_circle+100-50*i,this.x_circle+this.r_circle+5+50,this.y_circle+100-50*i],this.width=125,this.height=30,this.name=h,this.polyline="",this.id="",this.esquiss="",this.svg=n,this.type="method",this.draw()}draw(){this.polyline=aya.Polyline(this.points),this.ancre=aya.Circle(this.polyline.x,this.polyline.y,5),this.ancre.draw(),this.ancre.removeBoxFromDOM(),this.ancre.c_svg.setAttribute("fill","black"),this.id=aya.Rectangle(this.polyline.dest_x,this.polyline.dest_y-15,this.width,this.height),this.method_name=aya.Text(0,0,this.name),this.id.addChild(this.method_name,(t,s)=>{s.setOffsetX(t.x+t.width/3),s.setOffsetY(t.y+20)},(t,s)=>{},!1),this.polyline.draw(),this.id.draw(),this.polyline.c_svg.setAttribute("fill","none"),this.id.addEvent("mouseover",()=>{N.mouseovercb(this)}),this.id.addEvent("mouseleave",()=>{N.mouseleavecb(this)})}removeFromDOM(){}createArtefact(){var t=[this.id.x+this.id.width+-.25*this.width,this.id.y+this.id.height+0,this.id.x+this.id.width+0,this.id.y+this.id.height+0,this.id.x+this.id.width+0,this.id.y+this.id.height+200,this.id.x+this.id.width+300,this.id.y+this.id.height+200,this.id.x+this.id.width+300,this.id.y+this.id.height+-(400+this.height-50),this.id.x+this.id.width+0,this.id.y+this.id.height+-(400+this.height-50),this.id.x+this.id.width+0,this.id.y+this.id.height+-this.height,this.id.x+this.id.width+-.25*this.width,this.id.y+this.id.height+-this.height];this.esquiss=aya.Polyline(t),this.design_pattern.map((t,e)=>{this.esquiss.addChild(t,(t,s)=>{0==e&&(s.setOffsetX(t.x+31.25+25+25+25),s.setOffsetY(t.y-30+15-25-25)),1==e&&(s.setOffsetX(t.x+31.25+25+25),s.setOffsetY(t.y-30+15-25)),2==e&&(s.setOffsetX(t.x+31.25+25),s.setOffsetY(t.y-30+15)),3==e&&(s.setOffsetX(t.x+31.25+25+25),s.setOffsetY(t.y-30+15+25)),4==e&&(s.setOffsetX(t.x+31.25+25+25+25),s.setOffsetY(t.y-30+15+25+25))},(t,s)=>{},!1)}),this.esquiss.draw(),this.esquiss.children.map(({child:t})=>{t.draw()}),this.esquiss.c_svg.setAttribute("stroke-width","0px"),this.esquiss.addEvent("mouseover",()=>{D.mouseovercb(this)}),this.esquiss.addEvent("mouseleave",()=>{D.mouseleavecb(this)}),this.esquiss.children.map(({child:t})=>{t.addEvent("mouseover",()=>{P.mouseovercb({self:this,child:t})}),t.addEvent("mouseleave",()=>{}),t.addEvent("mousedown",()=>{P.mousedowncb({self:this,child:t})})})}removeArtefact(){this.esquiss.removeFromDOM(),this.svg.removeEventListener("mouseover",()=>{})}}class k{static mouseovercb(e){"mouseover"!=state&&(state="mouseover",(active_component=e).methods.map((t,s)=>{"arc"==t.type&&(t.draw(),console.log("arc drawing"),console.log(t.children),t.children.map(({child:t})=>{0==s&&(t.setRotateAngle(-20),t.setOffsetX(2),t.setOffsetY(-5)),1==s&&(t.setRotateAngle(-60),t.setOffsetX(2),t.setOffsetY(-10)),2==s&&(t.setRotateAngle(-90),t.setOffsetX(5),t.setOffsetY(-15)),3==s&&(t.setRotateAngle(-150),t.setOffsetX(20),t.setOffsetY(-2)),t.draw()}),t.addEvent("mouseover",()=>{L.mouseovercb(t)}),t.addEvent("mouseleave",()=>{L.mouseleavecb(t)}),t.addEvent("mousedown",()=>{L.mousedowncb({self:e,arc:t})}))}),e.svg.addEventListener("mouseover",()=>{console.log("mouseover svg"),"mouseover"!=state&&(console.log(active_component),active_component&&active_component.removeArtefact(),active_component=null)}))}static mouseleavecb(t){state=""}}class L{static mouseovercb(t){state="mouseover",t.c_svg.setAttribute("fill","black")}static mouseleavecb(t){t.c_svg.setAttribute("fill","white"),state=""}static mousedowncb(t){console.log("mousedown arc, comp actif"),console.log(active_component),t.self.svg.removeEventListener("mouseover",()=>{}),active_component.removeArtefact(),t.arc.children[0].child.draw(),active_component=null;var s,e=";";for(s of t.self.data.methods)if(s.name==t.arc.children[0].child.text){e=s.id;break}state="",t.self.methods[t.self.relocate(t.arc)]=new S(t.self.x,t.self.y,t.self.r,t.self.relocate(t.arc),e,t.self.svg)}}class N{static mouseovercb(t){state="mouseover",active_component||((active_component=t).createArtefact(),t.svg.addEventListener("mouseover",()=>{console.log("mouseover svg from over rect"),"mouseover"!=state&&(console.log(active_component),active_component&&active_component.removeArtefact(),active_component=null)}))}static mouseleavecb(t){state=""}}class D{static mouseovercb(t){state="mouseover"}static mouseleavecb(t){state=""}}class P{static mouseovercb(t){state="mouseover",t.child.c_svg.setAttribute("class","scroll")}static mouseleavecb(t){}static mousedowncb(t){var s;console.log("mousedown sur le text"),"adapter"==t.child.text?(console.log(t.child.text),s=aya.Image(t.self.id.x+5,t.self.id.y-t.self.height/2,30,30,"icons/adapter.png"),t.self.id.addChild(s,null,null,!1),t.child.removeFromDOM()):"composite"==t.child.text?(console.log(t.child.text),s=aya.Image(t.self.id.x+5,t.self.id.y-t.self.height/2,30,30,"icons/composite.png"),t.self.id.addChild(s,null,null,!1)):"chain of responsability"==t.child.text?(console.log(t.child.text),s=aya.Image(t.self.id.x+5,t.self.id.y-t.self.height/2,30,30,"icons/chain.png"),t.self.id.addChild(s,null,null,!1)):"decorator"==t.child.text?(console.log(t.child.text),s=aya.Image(t.self.id.x+5,t.self.id.y-t.self.height/2,30,30,"icons/decorator.png"),t.self.id.addChild(s,null,null,!1)):"strategy"==t.child.text&&(console.log(t.child.text),s=aya.Image(t.self.id.x+5,t.self.id.y-t.self.height/2,30,30,"icons/strategy.png"),t.self.id.addChild(s,null,null,!1))}}var H=["get","post","put","del"];class Z{constructor(t=0,s=0,e=5,i=40,h={},n,r){this.x=t,this.y=s,this.r=e,this.circle="",this.data=h,this.delta=0,this.arc_angle=i,this.methods=[],this.config=r,this.svg=n,this.type="ressource",this.draw()}draw(){!this.data.children&&!this.data.params&&!this.data.methods||this.data.children&&!this.data.methods&&!this.data.params?this.drawPath(this.data.path):(!this.data.children&&this.data.params||this.data.children&&this.data.params)&&this.drawParam(this.data.params),this.data.methods&&this.drawRessource(),this.data.children&&this.data.children.map(t=>{aya.Ressource(this.x+this.delta,this.y+50,this.r,this.arc_angle,t),this.delta=200})}drawPath(t){var s=aya.Component("circle",{x:this.x+100,y:this.y+50,r:10});s.form.c_svg.setAttribute("fill","#151e3e"),s.form.addChild(aya.Text(0,0,t),(t,s)=>{s.setOffsetX(t.x-t.r),s.setOffsetY(t.y-t.r-10)},(t,s)=>{},!0)}drawParam(t){t.map(t=>{var s=aya.Component("lozenge",{x:this.x+80,y:this.y-50,width:30,height:30}),t=(s.form.c_svg.setAttribute("fill","#415682"),aya.Text(0,0,"{"+t.name+"}"));s.form.addChild(t,(t,s)=>{s.setOffsetX(t.x-t.width/3-12),s.setOffsetY(t.y+t.height/2+5)},(t,s)=>{},!0)})}drawRessource(){var t,s=this.x,e=this.y+this.r+10;this.circle=aya.Component("circle",{x:this.x,y:this.y,r:this.r}),this.circle.form.c_svg.setAttribute("fill","#909294"),this.circle.form.removeBoxFromDOM(),Object.keys(this.data)&&(h=aya.Text(0,0,"res"),this.circle.form.addChild(h,(t,s)=>{s.setOffsetX(t.x-t.r/2+10),s.setOffsetY(t.y+5)},(t,s)=>{},!0),h.title.textContent="ressource");for(n of H){var i=aya.Arc(this.x,this.y,s,e,this.arc_angle,.75),h=(this.circle.form.addChild(i,null,null,!1),aya.Text(i.x+10,i.y,n));i.addChild(h,(t,s)=>{s.setOffsetX(0),s.setOffsetY(0)},(t,s)=>{s.setRotateCenter(s.x,s.y)},!1),this.circle.form.addChild(h,null,null,!1),this.methods.push(i),s=i.dest_x,e=i.dest_y}if(this.data.methods)for(var n of this.data.methods){for(var r of this.methods)if("arc"==r.type&&r.children[0].child.text==n.name){console.log("idx"),t=this.relocate(r);break}console.log("this.methods[idx]"),console.log(this.methods[t]),delete this.methods[t],this.methods[t]=new S(this.x,this.y,this.r,t,n.id,this.svg),this.methods[t].ancre.addChild(aya.Text(0,0,n.name),(t,s)=>{s.setOffsetX(t.x+10),s.setOffsetY(t.y+10)},(t,s)=>{},!0),this.methods[t].id.removeFromDOM(),this.methods[t].polyline.removeFromDOM()}this.methods.map(t=>{"method"==t.type&&t.ancre.addEvent("mousedown",()=>{(class{static mousedowncb(s){s.method.ancre.selected=!0,s.self.methods.map(t=>{"method"==t.type&&t!=s.method&&1==t.ancre.selected&&(t.id.removeFromDOM(),t.polyline.removeFromDOM(),t.ancre.selected=!1),"method"==t.type&&t==s.method&&(active_method=active_method==s.method?(console.log("active_ancre"),t.id.removeFromDOM(),t.polyline.removeFromDOM(),""):(s.method.id.draw(),s.method.polyline.draw(),s.method.id.addEvent("mouseover",()=>{N.mouseovercb(s.method)}),s.method.id.addEvent("mouseleave",()=>{N.mouseleavecb(s.method)}),s.method.polyline.c_svg.setAttribute("fill","none"),t))})}}).mousedowncb({self:this,method:t})})}),this.circle.form.addEvent("mouseover",()=>{k.mouseovercb(this)}),this.circle.form.addEvent("mouseleave",()=>{k.mouseleavecb(this)})}relocate(t){var s,e=-1;return this.methods.map((t,s)=>{console.log(t),"arc"==t.type&&-1==e&&(e=s)}),console.log("this.methods[min]"),console.log(this.methods[e]),s=this.methods[e].children[0].child.text,console.log("temp"),console.log(s),this.methods[e].children[0].text=t.children[0].child.text,t.children[0].child.text=s,e}removeArtefact(){this.methods.map(t=>{"arc"==t.type&&t.removeFromDOM()}),this.svg.removeEventListener("mouseover",()=>{})}}const U=require("jsdom")["JSDOM"],G=new U("...");class K{constructor(t=0,s=0,e=50,i=50,h,n){this.width=e,this.height=i,this.x=t,this.y=s,this.path=h,this.c_svg="",this.svg=n,this.draw()}draw(){this.c_svg=G.window.document.createElementNS("http://www.w3.org/2000/svg","image")||document.createElementNS("http://www.w3.org/2000/svg","image"),this.c_svg.setAttributeNS(null,"height",this.height),this.c_svg.setAttributeNS(null,"width",this.width),this.c_svg.setAttributeNS("http://www.w3.org/1999/xlink","href",this.path),this.c_svg.setAttributeNS(null,"x",this.x),this.c_svg.setAttributeNS(null,"y",this.y),this.svg.append(this.c_svg)}removeFromDOM(){this.svg.removeChild(this.c_svg)}}const Q=require("jsdom")["JSDOM"],tt=new Q("...");exports.ayajs=class{constructor(t=1343,s=1343){this.uuid=y.generate(),this.svg_width=t,this.svg_height=s,this.svg=tt.window.document.createElementNS("http://www.w3.org/2000/svg","svg")||document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.svg_width),this.svg.setAttribute("height",this.svg_height),this.svg.setAttribute("id",this.uuid),this.config=h,this.events=v.setup(this.svg,this.uuid,this.config),this.tail_px=25,this.nc=Math.floor(this.svg_width/this.tail_px)+1,this.nl=Math.floor(this.svg_height/this.tail_px)+1,this.u_tail_px=10,this.u_nc=Math.floor(this.tail_px/this.u_tail_px),this.u_nl=Math.floor(this.tail_px/this.u_tail_px),this.box=this.Component("rectangle",{x:0,y:0,height:this.svg_height,width:this.svg_width}),this.box.form.c_svg.setAttributeNS(null,"fill","#FFFF"),this.box.form.c_svg.setAttribute("stroke","#57564F"),this.box.form.c_svg.setAttributeNS(null,"stroke-width","0.5pt"),this.box.form.vertex.map(t=>{t.removeFromDOM()}),this.box.form.c_points.map(t=>{t.removeFromDOM()}),Object.keys(this.box.form.events).map(t=>{this.box.form.deleteEvent(t)});for(var e=1;e<=this.nl-1;e++){var i=this.Line(0,e*this.tail_px,this.nl*this.tail_px,e*this.tail_px);this.box.form.addChild(i,(t,s)=>{},(t,s)=>{}),i.c_svg.setAttribute("fill","#B266FF"),i.c_svg.setAttribute("stroke","#57564F"),i.c_svg.setAttributeNS(null,"stroke-width","0.8pt"),i.children.map(({child:t})=>{t.removeFromDOM()}),i.vertex.map(t=>{t.removeFromDOM()}),i.c_points.map(t=>{t.removeFromDOM()}),Object.keys(i.events).map(t=>{i.deleteEvent(t)})}for(e=1;e<=this.nc-1;e++){i=this.Line(e*this.tail_px,0,this.tail_px*e,this.nc*this.tail_px);this.box.form.addChild(i,(t,s)=>{},(t,s)=>{}),i.c_svg.setAttribute("fill","#B266FF"),i.c_svg.setAttribute("stroke","#57564F"),i.c_svg.setAttributeNS(null,"stroke-width","0.8pt"),i.children.map(({child:t})=>{t.removeFromDOM()}),i.vertex.map(t=>{t.removeFromDOM()}),i.c_points.map(t=>{t.removeFromDOM()}),Object.keys(i.events).map(t=>{i.deleteEvent(t)})}this.svg.addEventListener("mousemove",this.events.mouseMoveCb),this.svg.addEventListener("mouseup",this.events.mouseUpCb)}Component(t,s){return new C(t,s,this.svg,this.events,this.config)}Rectangle(t=0,s=0,e=10,i=10){return new c(y.generate(),t,s,e,i,this.svg,this.events,this.config)}Lozenge(t=0,s=0,e=10,i=10){return new b(y.generate(),t,s,e,i,this.svg,this.events,this.config)}Triangle(t=0,s=0,e=5,i=5,h=10,n=10){return new w(y.generate(),t,s,e,i,h,n,this.svg,this.events,this.config)}Circle(t=0,s=0,e=5){return new o(y.generate(),t,s,e,this.svg,this.events,this.config)}Text(t=0,s=0,e="text"){return new A(y.generate(),t,s,e,this.svg,this.events,this.config)}Line(t=0,s=0,e=t,i=s){return new p(this.uuid,this.svg,this.events,this.config,y.generate(),t,s,e,i)}Polyline(t=[]){return new X(y.generate(),t,this.svg,this.events,this.config)}Point(t=0,s=0,e=5){return new l(y.generate(),t,s,e,this.svg,this.events,this.config)}Arc(t=0,s=0,e=100,i=100,h=90,n=.5){return new Y(y.generate(),t,s,e,i,h,n,this.svg,this.events,this.config)}Group(){return new E(y.generate(),this.svg,this.events,this.config)}Ressource(t=0,s=0,e=5,i=40,h={}){return new Z(t,s,e,i,h,this.svg,this.config)}Image(t,s,e,i,h=""){return new K(t,s,e,i,h,this.svg)}}},"function"==typeof define&&define.amd?define(t):t();